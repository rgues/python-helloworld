{"version":3,"sources":["./src/app/dashboard/join-tontine/join-tontine.module.ts","./src/app/dashboard/join-tontine/join-tontine.page.ts","./src/app/dashboard/join-tontine/join-tontine.page.scss","./src/app/dashboard/join-tontine/join-tontine.page.html"],"names":[],"mappings":"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","file":"join-tontine-join-tontine-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { JoinTontinePage } from './join-tontine.page';\nimport { SharedModule } from 'src/app/shared/shared.module';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: JoinTontinePage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ReactiveFormsModule,\n    SharedModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [JoinTontinePage]\n})\nexport class JoinTontinePageModule {}\n","import { Component, OnInit } from '@angular/core';\r\nimport { Validators, FormBuilder, FormGroup } from '@angular/forms';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { ErrorService } from 'src/app/shared/service/error.service';\r\nimport { InvitationsService } from '../invitations/service/invitations.service';\r\nimport { Router } from '@angular/router';\r\nimport { NavController } from '@ionic/angular';\r\nimport { InivitationErrorService } from 'src/app/dashboard/invitations/service/inivitation-error.service';\r\nimport { UserService } from '../user/service/user.service';\r\nimport { EventService } from 'src/app/shared/service/events.service';\r\nimport { UiService } from 'src/app/shared/service/ui.service';\r\n\r\n@Component({\r\n  selector: 'app-join-tontine',\r\n  templateUrl: './join-tontine.page.html',\r\n  styleUrls: ['./join-tontine.page.scss'],\r\n})\r\nexport class JoinTontinePage implements OnInit {\r\n\r\n  joinTontineForm: FormGroup;\r\n  validationMessages: any;\r\n  name: string;\r\n  loading: boolean;\r\n  states: any[];\r\n  currentUser: any;\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private translate: TranslateService,\r\n    private userService: UserService,\r\n    private navigator: NavController,\r\n    private events: EventService,\r\n    private ui: UiService,\r\n    private router: Router,\r\n    private invitation: InvitationsService,\r\n    private invitationError: InivitationErrorService,\r\n    private error: ErrorService\r\n  ) {\r\n    this.loading = false;\r\n    this.name = '';\r\n    this.states = [];\r\n    this.currentUser = this.userService.getUserData();\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.initValidationMessage();\r\n    this.initjoinTontineForm();\r\n  }\r\n\r\n  \r\n  // Form getters\r\n  get joinCode() {\r\n    return this.joinTontineForm.get('code_invitation');\r\n  }\r\n\r\n  get joinContact() {\r\n    return this.joinTontineForm.get('emailOrphone');\r\n  }\r\n\r\n  // Init the form message\r\n  initValidationMessage() {\r\n    this.translate.get(['M_TONTINE_CODE_REQUIRED', 'M_EMAIL_PHONE_REQUIRED']).subscribe(trans => {\r\n      this.validationMessages = {\r\n        code: [\r\n          { type: 'required', message: trans.M_TONTINE_CODE_REQUIRED }\r\n        ],\r\n        contact: [\r\n          { type: 'required', message: trans.M_EMAIL_PHONE_REQUIRED }\r\n        ]\r\n      };\r\n    });\r\n  }\r\n\r\n\r\n  // Init Join tontine form\r\n  initjoinTontineForm() {\r\n    let prefix = '';\r\n    const credentials = this.userService.getUserSecret();\r\n    prefix = credentials ? credentials.phone_prefix : '';\r\n    const currentUser = this.userService.getUserData();\r\n    this.joinTontineForm = this.fb.group({\r\n      code_invitation: ['', Validators.required],\r\n      prefix: [prefix],\r\n      phone_prefix: [prefix],\r\n      sendMode: ['sms'],\r\n      phoneid: [prefix],\r\n      phone: [currentUser && currentUser.phone ? currentUser.phone : ''],\r\n      emailOrphone: [currentUser && currentUser.phone ? currentUser.phone : currentUser.email, Validators.required]\r\n    });\r\n  }\r\n\r\n\r\n  // Join a tontine\r\n  joinTontine() {\r\n    this.loading = true;\r\n    this.invitation.acceptInvitationTontineWithToken(this.joinTontineForm.value)\r\n      .subscribe((reponse: any) => {\r\n        this.loading = false;\r\n        if (reponse && reponse.success) {\r\n          this.initjoinTontineForm();\r\n          this.translate.get('USER_SECURITY_MSG10').subscribe(value => {\r\n            this.ui.presentToast(value);\r\n          });\r\n          this.events.publish('new-tontine');\r\n          this.navigator.setDirection('root');\r\n          this.router.navigate(['dashboard/my-tontines']);\r\n        }\r\n\r\n      }, error => {\r\n        this.loading = false;\r\n        if (error && error.error && !error.error.success) {\r\n            if (error.error.user_not_found) {\r\n              this.loading = true;\r\n              this.error.renewSession().then((data: any) => {\r\n                    if (data && data.result === \"OK\") {\r\n                          this.joinTontine();\r\n                    } else {\r\n                      this.loading = false;\r\n                    }\r\n              });\r\n            } else {\r\n              this.invitationError.manageInvitationError(error);\r\n            }\r\n        } else {\r\n          this.error.manageError(error);\r\n        }\r\n      });\r\n  }\r\n\r\n}\r\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJqb2luLXRvbnRpbmUucGFnZS5zY3NzIn0= */\";","export default \"<ion-header>\\r\\n  <ion-toolbar class=\\\"with-logo2\\\">\\r\\n    <ion-buttons slot=\\\"start\\\">\\r\\n      <ion-back-button color=\\\"primary\\\" defaultHref=\\\"/dashboard/my-tontines\\\" ></ion-back-button>\\r\\n    </ion-buttons>\\r\\n    <ion-title class=\\\"ion-text-center title-md-right\\\">\\r\\n      <ion-img class=\\\"logo\\\" [src]=\\\"'assets/logo-toupesu.svg'\\\"></ion-img>\\r\\n    </ion-title>\\r\\n  </ion-toolbar>\\r\\n  <ion-toolbar class=\\\"ion-text-center subtitle\\\">\\r\\n    <ion-title>{{ 'MENU_JOIN_TONTINE' | translate }}</ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content class=\\\"join-tontine\\\">\\r\\n  <ion-grid>\\r\\n    <ion-row>\\r\\n      <ion-col class=\\\"ion-padding\\\">\\r\\n        <ion-text>{{ 'JOIN_TONTINE_MSG' | translate }}. {{'JOIN_TONTINE_MSG3' | translate }}.</ion-text>\\r\\n      </ion-col>\\r\\n    </ion-row>\\r\\n    <ion-row>\\r\\n      <ion-col size=\\\"12\\\">\\r\\n        <ion-card>\\r\\n          <ion-card-content>\\r\\n            <form [formGroup]=\\\"joinTontineForm\\\">\\r\\n              <ion-item>\\r\\n                <ion-label position=\\\"floating\\\">{{ 'JOIN_TONTINE_MSG1' | translate }}</ion-label>\\r\\n                <ion-input type=\\\"number\\\" formControlName=\\\"code_invitation\\\" required></ion-input>\\r\\n              </ion-item>\\r\\n              <div class=\\\"validation-errors\\\">\\r\\n                <ng-container *ngFor=\\\"let validation of validationMessages.code\\\">\\r\\n                  <div class=\\\"error-message\\\"\\r\\n                    *ngIf=\\\"joinCode.hasError(validation.type) && (joinCode.dirty || joinCode.touched)\\\">\\r\\n                    <ion-icon name=\\\"information-circle-outline\\\"></ion-icon>\\r\\n                    {{ validation.message }}\\r\\n                  </div>\\r\\n                </ng-container>\\r\\n              </div>\\r\\n            </form>\\r\\n          </ion-card-content>\\r\\n        </ion-card>\\r\\n      </ion-col>\\r\\n    </ion-row>\\r\\n  </ion-grid>\\r\\n\\r\\n</ion-content>\\r\\n\\r\\n<ion-footer class=\\\"ion-padding ion-text-center\\\">\\r\\n  <ion-grid>\\r\\n    <ion-row>\\r\\n      <ion-col>\\r\\n        <ion-button expand=\\\"full\\\" [disabled]=\\\"joinTontineForm.invalid || loading\\\" (click)=\\\"joinTontine()\\\"\\r\\n          color=\\\"warning\\\" class=\\\"ion-text-uppercase\\\" shape=\\\"round\\\">\\r\\n          {{ 'JOIN_TEXT' | translate }}\\r\\n        </ion-button>\\r\\n        <ion-spinner *ngIf=\\\"loading\\\" name=\\\"circles\\\"></ion-spinner>\\r\\n      </ion-col>\\r\\n    </ion-row>\\r\\n  </ion-grid>\\r\\n</ion-footer>\";"],"sourceRoot":"webpack:///"}